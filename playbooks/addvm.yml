---

- name: "Playbook: Add VM"
  hosts: "{{ args_host }}"
  gather_facts: false

  vars_files:
    - /etc/ansible/inventory/vars.yml

  roles:
    - name: alex.proxmox.status
      vars:
        args_vmid: "{{ prop_proxmox_vmid }}"
        args_proxmox_host: "{{ prop_proxmox_host }}"
      failed_when: '"NOTEXIST" not in vmstatusresult.stdout'
    - name: alex.proxmox.addvm
      vars:
        args_vmid: "{{ prop_proxmox_vmid }}"
        args_proxmox_host: "{{ prop_proxmox_host }}"
        args_template: "{{ prop_proxmox_template }}"
        args_proxmox_name: "{{ prop_proxmox_name }}"
        args_hostname: "{{ prop_hostname }}"
        args_description: "{{ prop_description }}"
        args_ipaddress: "{{ prop_ipaddress }}"
        args_vm_mac: "{{ prop_vm_mac }}"
        args_vm_vlan: "{{ prop_vm_vlan }}"
        args_vm_mac2: "{{ prop_vm_mac2 }}"
        args_vm_vlan2: "{{ prop_vm_vlan2 }}"
        args_vm_memory: "{{ prop_vm_memory }}"
        args_vm_cores: "{{ prop_vm_cores }}"
        args_vm_start_boot: "{{ prop_vm_start_boot }}"
