---

- name: "Playbook: Add VM"
  hosts: "{{ args_host }}"
  gather_facts: false
  become: true
  vars:
    ansible_connection: ssh
    ansible_host: "{{ args_proxmox_host }}"

  vars_files:
    - /etc/ansible/inventory/vars.yml

  roles:
    - name: alex.proxmox.status
      vars:
        args_vmid: "{{ args_proxmox_template }}"
      failed_when: '"NOTEXIST" not in vmstatusresult.stdout'
    - name: alex.proxmox.addvm
      vars:
        args_vmid: "{{ args_proxmox_vmid }}"
        args_template: "{{ args_proxmox_template }}"
